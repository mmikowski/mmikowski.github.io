---
layout: post
title: Install Kubuntu 19.10 and Apps for Web Dev
---
*Install and optimize Kubuntu 19.10 and Apps for Web Development
in about an hour*

<style>
table { font-size: 12px; line-height: 14px; font-family:unset; }
</style>

## 1. Overview
Provide a start-to-finish guide to install and configure Kubuntu 19.10
(K19-10) and web development tools.

-   Ensure answers are thorough and well-researched.
-   Show screen shots for almost every step.
-   Provide an explanation for each step.
-   Add links to external resources when beneficial.

## 2. Why Kubuntu?

## 3. How are you qualified?
I have used Unix or Linux as his primary OS for web app development from 1993,
Linux from 1998, since 2006.  I've maintained a [Kubuntu Preferred Apps
Spreadsheet](https://docs.google.com/spreadsheets/d/1kLIYKYRsan_nvqGSZF-xJNxMkivH7uNdd6F-xY0hAUM) since 2014, and have managed the software on multiple Linux clusters with
dozens of servers each. I am RHEL5 certified (giggle if you must).

## Table of Contents {#toc}
1.  [Review Selected Apps](#section1)
2.  [Prepare a VirtualBox computer](#section2)
3.  [Install Kubuntu 19.10 Beta](#section3)
4.  [Apply updates](#section4)
5.  [Integrate with Virtual Box](#section5)
6.  [Configure Plasma](#section6)
7.  [Set-up Repositories and Install Apps](#section7)
8.  [Install Addon Apps](#section8)
9.  [Optimize Apps](#section9)
10. [Appendix A](#apdx-a)

## 1. Review Selected Apps [(top)](#toc) {#section1}

Review the K19-10 Selected Apps chart below. These apps are installed or
optional in the steps below. Adjust as needed.

K19-10 Selected Apps

Source key: repo = standard repo; crepo = custom (added) repo, custom =
custom installation; addon = added after repo install

| Role        | Name  | Source   | Notes  | Tags   | Updated  | Inc. |
| :---        | :---  | :---     | :---   | :---   | :---     | :--- |
| Role        | Name  | Source   | Notes  | Tags   | Updated  | Inc. |
| Audio control | pavucontrol | repo | Pulse audio volume and other settings. | audio, volume, mix, gstreamer, pulse audio | 2019-10-04 | Yes |
| Android Files | kde-connect, mtp-tools | repo | Android connection. Browser extensions for kde-connect are highly recommended. | mtp, android | 2019-10-04 | Yes |
| Audio Editing | audacity | repo | Audio editor | audio, wav, mp3, ogg | 2019-10-04 | Yes |
| Benchmark | sysbench | repo | Benchmark CPU, Disk, MySQL | benchmark | 2019-10-04 | Yes |
| Blog | blog, html, css, github | repo | Jekyll | blog, html, css, github | 2019-10-15 | Addon |
| Browser | google chrome | crepo | Best debugger, android integraction chrome://inspect | browser, v8, html, javascript, css, web | 2019-10-04 | Yes |
| Browser | firefox, firefox-locale-en | repo | Firefox browser | browser, tracemonkey, spidermonkey, html, javascript, css, web | 2019-10-04 | Yes |
| Clean custom repos | ppa-purge | repo | Useful for removing repos and reverting to stock packages. For example, xorg-edgers can be trouble. See note \[Q\]. | ppa, purge, repository, remove | 2019-10-04 | Yes |
| Clipboard | \-- | \-- | Multi-register clipboard is now a core capability of Plasma. Remember to use it! | clipboard | 2019-10-04 | Yes |
| Codecs | codecs | repo | proprietary codecs kubuntu-restricted-extras, kubuntu-restricted-addons | flash, codec, movies, mp3 | 2019-10-04 | Yes |
| Compression | optipng | repo | Optimize PNG compression | png, compress | 2019-10-04 | Yes |
| Compression | rar | repo | RAR compression utilities | | 2019-10-04 | Yes |
| Compression | shrinkpdf | script | I used this to reduce a 5.2MB pdf to .18MB. Amazing. | pdf, compression, script | 2019-10-04 | Addon |
| Database | mysql, mysql-server | repo | A fantastic OSS option. Others include PostGreSQL, Mongo (better as a JSON cache, IMO), SQLite, etc. | sql | 2019-10-08 | Yes |
| Dev - IDE | intellij ultimate | custom | Web application development IDE, best-in-class ease of use and feature.  I now use this instead of Webstorm as I need support for more languages.  Webstorm, RubyMine, Pycharm, et. al. are subsets. | java, python, javascript, css, html, bash, perl, xml, json | 2019-10-04 | Addon |
| Dev - Standard | build-essential openssh-server wajig | repo | Install these for app dev env. Rember ssh -X does X11 forwarding (very, very handy!). Make sure this is enabled by the openssh server first though. See this guide: https://unix.stackexchange.com/questions/12755 | tool chain, ssh, X11 | 2019-10-04 | Yes |
| Disk bench | bonnie++ | repo | Benchmark disk. | benchmark, disk, performance, read, write | 2019-10-08 | Yes |
| Disk bench | hdparm | repo | A simpler test: hdparm -t /dev/\<disk\> and hdparm -T /dev/\<disk\>. Use sdparm or hdparm -I /dev/sda to identify. | benchmark, disk, performance, read, write | 2019-10-04 | Yes |
| Doc Conversion | pandoc | repo | Useful to convert markdown -\> pdf or other formats. One must install pandoc pandoc-citeproc texlive haskell-platform | pdf, html, ODT, RTF, Textile, text, AsciiDoc, Epub | 2019-10-04 | Yes |
| Docker | docker-ce | crepo | Industry standard containers. | containers, docker | 2019-10-04 | Addon |
| Dropbox | dropbox | crepo | Fastest shared file solution | dropbox, share, shared, files | 2019-10-04 | Addon |
| DVD Rip | k3b | repo | CD and DVD ripper and burner | dvd, cd, burn, rip | 2019-10-04 | Yes |
| Encode | ffmpeg | repo | Encoding to mp3, video codecs. Was formerly replaced with a fork of ffmpeg called \'lib-avtools\'. Use \'avconv\' and \'avplay\' | mp3, mp4, ffmpeg, avconv, avplay | 2019-10-08 | Yes |
| Fonts | ttf-mscorefonts-installer | repo \[YE\] | Install to get Arial, Courier new, and other standard MS fonts. | fonts, truetype | 2019-10-04 | Yes |
| Hardware Info | hwinfo, lshw, lspci, lsusb, dmidecode | repo | List motherboard, peripherials, etc. Also try \'cat /proc/cpuinfo\' | hardware, peripherals, usb, pci | 2019-10-04 | Yes |
| Image Edit | gimp, gimp-data-extras, gimp-help-en | repo, crepo | Very photoshop like and quite compatible with Adobe tools. Use \`dbus-launch gimp\` if screen capture isn\'t working. | graphics, photoshop, red eye. CMYK plugin: http://cue.yellowmagic.info/softwares/separate-plus/index.html | 2019-10-04 | Yes |
| Image SVG | inkscape | crepo \[S\] | A very good SVG editor | graphics, SVG | 2019-10-04 | Yes |
| Java | openjdk | repo | OpenJDK has become defacto; if Oracle is needed, see notes install notes below. | java, jdk, jre, oracle | 2019-10-04 | Yes |
| JSON prettyprint | python | \-- | For convenience add this to \~/.bashrc: alias prettyjson=\'python -m json.tool\'. See JSON.stringify(obj, null, 2) for a faster alternative. | 2019-10-04 | Yes |
| Music Player | Cantana | repo | Looks interesting, but I have not used it. | mp3, music, album | 2019-10-04 | Yes |
| Network Files | nfs-common | repo | NFSv4 Network files system. | nfs, nfsv4, filesystem | 2019-10-04 | Yes |
| NodeJS | nodejs | crepo | JavaScript web server | nodejs, node.js, npm | 2019-10-04 | Yes |
| Office Suite | LibreOffice | repo | Version 6.3 | Word, Excel, Access, Base, Sheets, Presents, Keynote, Powerpoint | 2019-10-04 | Yes | 
| Package mgmt | apt, dpkg | repo | See Notes \[W\] and \[X\] | apt, apt-cache, apt-get, hold, muon, pin, wajig, Discover | 2019-10-04 | Yes |
| PDF annotate | okular | repo | Best PDF view/annotator for linux | view, annotate, PDF | 2019-10-04 | Yes |
| PDF diff | diffpdf | repo | Compare PDF content or visuals | diff, compare, PDF | 2019-10-08 | Yes | 
| PDF Edit | pdfshuffler | repo | See all pdf tools, type pdf\<tab\> | concatenate, rearrange, delete, PDF | 2019-10-08 | Yes |
| Power Control | upower | repo | Use \'upower -e\' to show devices and upower -i \'device\' to inspect.  Should be installed by default. See http://askubuntu.com/questions/69556 | power, laptop, battery, command line, cli | 2019-10-08 | Yes |
| Screen recording | simple screen recorder, obs-studio | repo | The first (simplescreenrecorder) is easiest to use, the last (obs-studio) was more powerful but more complex and less stable. | screencast, recorder, audio, video, capture | 2019-10-08 | Yes |
| Slack | slack-desktop | repo | Available in Multiverse as slack-desktop | slack | 2019-10-08 | Addon |
| Steam | steam | repo | Available in Multiverse as steam-installer | steam | 2019-10-08 | Yes |
| Source Control | git, subversion, gitolite3 | repo | Use GitoLite as a git repository. Setup is 5 minutes. See https://help.ubuntu.com/lts/serverguide/git.html and http://blog.aplikacja.info/2010/08/switch-origin-of-your-git-repository/ | scms, git, svn, subersion | 2019-10-08 | Yes |
| Telegram | telegram, telegram-cli, telegram-desktop, telegram-purple | repo | Emerson Pardo recommended Telegram. | telegram, messaging, whatsapp | 2019-10-08 | Addon |
| Text editor | vim or neovim | repo | I switch between the two. | vim, neovim | 2019-10-08 | Yes |
| Virtual terminal resolution | grub | repo\[U\] | See notes | grub, grub2, vbeinfo, vga | 2019-10-08 | Yes |
| Video Acceleration | vdpau | repo | Provides hardware encoding and decoding | gpu, Nvidia, vdpau, encode, decode, hardware | 2019-10-08 | Yes |
| Video Chat | Hangouts | n/a | Use Google Hangoouts in Google Chrome | talk, voice, voip | 2019-10-08 | n/a |
| Video Encode | handbrake | crepo | Usually better at backing up encrypted content. Previously the Handbrake in the repo had mp4 support disabled. Have not confirmed for 19.10. | dvd, burn, rip | 2019-10-04 | Yes |
| Video Player | vlc | repo | VLC plays just about all formats. Handy to have around | video, movie, playback | 2019-10-08 | Yes |
| Visual Diff | meld, kdiff3 | repo | Compare 3 sources across directory trees. Much better than Github when trying understand how things have changed. Meld has a nicer interface, but sometimes Kdiff3 is faster. | diff, visual diff, meld, kdiff3 | 2019-10-08 | Yes |
| Wallpapers | backgrounds | repo | Various backgrounds are found in /usr/share/backgrounds and /usr/share/wallpapers. | ubuntu-wallpapers ubuntu-wallpapers-\<release\> plasma-workspace-wallpapers | 2019-10-08 | Yes |
| Webcam control | guvcview | repo | Great tools for tesing webcam | webcam, cam | 2019-10-08 | Yes |
| Wireframes | Balsamiq Mockups | custom | An easy-to-use wireframe tool. Version 3 provides symbols so that engineering drawing change control is now easier. | wireframes, mockups | 2019-10-08 | Addon |
| X select | xsel | repo | X selection utility, useful for cut-n-paste for vim | xsel, X select | 2019-10-08 | Yes |


## 2. Prepare a VirtualBox computer [(top)](#toc) {#section2}

Skip this section when installing on a physical computer.

### 2.1. Why a virtual computer?

We recommend using a virtual computer to test Kubuntu 19.10 and apps
before Beta is complete. We use Kubuntu 19.04 as the **Host OS** and
install these packages.

```bash
sudo install virtualbox virtualbox-ext-pack
virtualbox-guest-additions-iso
```

The extension pack is used by VirtualBox to enable USB2+ and other
features. The guest additions are used by the **Guest OS** to improve
integration with the **Host OS**. VirtualBox will instruct the user to
enable DKMS in the BIOS if needed.

### 2.2. Mount The guest additions image

The **Guest OS** is prone to graphics artifacts and integration
limitations with the Kubuntu 19.04 **Host OS** until these additions are
installed. A virtual CD image must be mounted proceed.

### 2.2.1. Select the instance and click settings

![k19-10 Virtualbox - Click
Settings](/images/2019-10-04-k19-10/20191009_203135.png "k19-10 Virtualbox - Click Settings")

### 2.2.2 Visit the tabs on the left

![k19-10 Virtualbox - Visit
tabs](/images/2019-10-04-k19-10/20191009_203206.png "k19-10 Virtualbox - Visit tabs")

### 2.2.3. Click on Storage and click the plus button

![k19-10 Virtualbox - Click on
plus](/images/2019-10-04-k19-10/20191009_203315.png "k19-10 Virtualbox - Click on plus")

### 2.2.4. Click to add an optical drive

![k19-10 Virtualbox - Add optical
drive](/images/2019-10-04-k19-10/20191009_203537.png "k19-10 Virtualbox - Add optical drive")

### 2.2.5. Click on \'Choose Disk\'

![k19-10 Virtualbox - Click on Choose
disk](/images/2019-10-04-k19-10/20191009_203555.png "k19-10 Virtualbox - Click on Choose disk")

### 2.2.6 Click on \'Add disk image\'

![k19-10 Virtualbox - Click on Add disk
image](/images/2019-10-04-k19-10/20191009_203642.png "k19-10 Virtualbox - Click on Add disk image")

### 2.2.7 Select /usr/share/virtualbox/VBoxGuestAdditions.iso

![k19-10 Virtualbox - Select
/usr/share/virtualbox/VBoxGuestAdditions.iso](/images/2019-10-04-k19-10/20191009_203709.png "k19-10 Virtualbox - Select /usr/share/virtualbox/VBoxGuestAdditions.iso")

### 2.2.8. Verify ISO image has been added

![k19-10 Virtualbox - Verify ISO image has been
added](/images/2019-10-04-k19-10/20191009_203830.png "k19-10 Virtualbox - Verify ISO image has been added")

### 2.2.9. Click OK

![k19-10 Virtualbox - Click
OK](/images/2019-10-04-k19-10/20191009_203911.png "k19-10 Virtualbox - Click OK")

### 2.2.10. Power-on the virtual computer

![k19-10 Virtualbox - Power-on the virtual
computer](/images/2019-10-04-k19-10/20191009_203954.png "k19-10 Virtualbox - Power-on the virtual computer")

## 3. Install Kubuntu 19.10 Beta [(top)](#toc) {#section3}

### 3.1 Download the ISO Image

Download the [19.10 Beta ISO bootable
Image](https://kubuntu.org/news/kubuntu-eoan-ermine-19-10-beta-released/)
directly from Kubuntu. This release remains in Beta until at least
2019-10-17, and is not recommended for daily use. The image will be
moved [here](https://kubuntu.org/getkubuntu/) when it becomes available
as a general release. Our testing to date has shown all apps working
well with just some config adjustments which have been updated in this
document. The bootable ISO name should look like
`kubuntu-19.10-beta-desktop-amd64.iso`.

### 3.2. Create a Bootable USB Drive

#### 3.2.1. VirtualBox

Skip this step. VirtualBox uses the ISO file directly.

#### 3.2.2 Physical Computer

Insert a small (4-8GB) USB drive into the computer with the downloaded
ISO image. If needed, install the \'Start Disk Creator\' using
`sudo apt install -y usb-creator-kde` and then run it from the K-menu or
enter `usb-creator-kde` in the terminal. Select the ISO image and select
the USB drive and the click on \'Make Startup Disk\'. All content of the
USB drive will be replaced in this operation.

![K19-10 Startup Disk
Creator](/images/2019-10-04-k19-10/20191011_173827.png "K19-10 Startup Disk Creator")

To use the CLI instead, see this [Ask Ubuntu
answer](https://askubuntu.com/questions/372607).

### 3.3. Boot from the Bootable USB Drive

#### 3.3.1. VirtualBox

VirtualBox will prompt for the ISO file to boot from when a new virtual
computer is started. Provide the ISO file previously downloaded, e.g.
`kubuntu-19.10-beta-desktop-amd64.iso`.

#### 3.3.2. Physical computer

Power-off the target computer and insert the Bootable USB Drive into a
USB port and then power-on. One may need to select the boot device
(typically using the F12 key) if the installer does not appear and try
again. Once the installer is present, click on **Install Kubuntu** to
begin.

![K19-10 Live USB First
Screen](/images/2019-10-04-k19-10/20191003_102037.png "K19-10 Live USB First Screen")

### 3.4. Select keyboard

This typically requires no changes.

![K19-10 Select
keyboard](/images/2019-10-04-k19-10/20191003_102050.png "K19-10 Select keyboard")

### 3.5. Select default install

Select the default install. Skimping on tools to save perhaps a GB or
two of diskspace is hardly worth it.

![K19-10 Select default
install](/images/2019-10-04-k19-10/20191003_102104.png "K19-10 Select default install")

### 3.6. Elect to edit partitions

Select \"Manual\" and click \"Continue\" to partition disk.

![K19-10 Elect to edit
partitions](/images/2019-10-04-k19-10/20191003_102217.png "K19-10 Elect to edit partitions")

### 3.7. Specify partitions sizes

Use a minimum of 32GB disk with 8GB reserved for a swap partition. The
swap *partition* is useful to provide computer-suspend support.

![K19-10 Specify parition
sizes](/images/2019-10-04-k19-10/20191003_102322.png "K19-10 Specify parition sizes")

### 3.8. Commit partition changes

This **will remove** any prior content in the partitions. Click on
**Install Now** to proceed.

![K19-10 Commit partition
changes](/images/2019-10-04-k19-10/20191003_102333.png "K19-10 Commit partition changes")

### 3.9. Select time zone

Select a time soon an click **Continue**

![K19-10 Select time
zone](/images/2019-10-04-k19-10/20191003_102346.png "K19-10 Select time zone")

### 3.10. Create admin user

This user will have admin (sudo) rights.

![K19-10 Create admin
user](/images/2019-10-04-k19-10/20191003_102821.png "K19-10 Create admin user")

### 3.11. Watch the slide show

Installation will take a minimum of about 5 minutes, but could take
quite a bit longer if the hard drive is slow (i.e. not an SSD) or the
internet connection or CPU is slow.

![K19-10 Watch the slide
show](/images/2019-10-04-k19-10/20191003_102829.png "K19-10 Watch the slide show")

### 3.12. Keep watching

More slides will appear. Do not be alarmed.

![K19-10 Keep
watching](/images/2019-10-04-k19-10/20191003_103135.png "K19-10 Keep watching")

### 3.13. Complete install and reboot

After the installation is complete restart elect to reboot the system.
On the virtual box, power-off the virtual computer and then ensure the
ISO image is no longer used for boot. On a physical computer, power-off
the computer and unplug the Bootable USB Drive. Then reboot.

![K19-10 Complete install and
reboot](/images/2019-10-04-k19-10/20191003_103756.png "K19-10 Complete install and reboot")

## 4. Apply Updates [(top)](#toc) {#section4}

### 4.1. First sign-in

This sign-in screen should appear 20-30s after boot. Enter the username
and password provided earlier.

![K19-10 First
sign-in](/images/2019-10-04-k19-10/20191003_103835.png "K19-10 First sign-in")

### 4.2. Enjoy the splash screen

Plasma has a splash screen which looks like this. On modern hardware, it
appears for less than 5 seconds, and often less than one second. We
disable it in the steps below.

![K19-10 Splash
screen](/images/2019-10-04-k19-10/20191003_103900.png "K19-10 Splash screen")

### 4.3. Review desktop

This is the default desktop.

![K19-10 Default
desktop](/images/2019-10-04-k19-10/20191003_103907.png "K19-10 Default desktop")

### 4.4. Open Discover app

The user is notified of updates on sign-in. As a habit, it is best to do
install updates right after install and at the beginning of every work
day. Click on **Update** in the notification to open the Discover
software package management app. Once can also start Discover from the
K-menu at the Bottom Left. Once open, click on **Updates** at the bottom
left of the app to see all updates.

![K19-10 Open Discovery
app](/images/2019-10-04-k19-10/20191003_103919.png "K19-10 Open Discovery app")

### 4.5. Initiate updates

There are over one hundred updates available. Click on **Update All** at
the top right.

![K19-10 Initiate
updates](/images/2019-10-04-k19-10/20191003_104008.png "K19-10 Initiate updates")

### 4.6. Authorize updates

Provide the user password to proceed.

![K19-10 Authorize
updates](/images/2019-10-04-k19-10/20191003_104035.png "K19-10 Authorize updates")

### 4.7 Watch update progress

The task bar indicator shows percentage completion which is a nice
touch. Our 71 updates took around 5 minutes.

![K19-10 Watch update
progress](/images/2019-10-04-k19-10/20191003_104141.png "K19-10 Watch update progress")

### 4.8. Complete updates and power-off

Successful completion of updates should look like the following
screenshot. After this is finished, use the menu to power-off the
computer.

![K19-10 Complete updates and
power-off](/images/2019-10-04-k19-10/20191003_104314.png "K19-10 Complete updates and power-off")

## 5. Integrate with Virtual Box [(top)](#toc) {#section5}

Skip this section when installing on a physical computer.

### 5.1. Open the guest additions disk

The guest additions appear as an optical disk. Click on the USB icon to
access this disk and open it with the file manager.

![K19-10 VirtualBox - Open guest addition disk
](/images/2019-10-04-k19-10/20191003_104351.png "K19-10 VirtualBox - Open guest addition disk ")

### 5.2. Open a terminal

Right click on the file view and select **Actions \> Open Terminal
Here**.

![K19-10 VirtualBox - Open
terminal](/images/2019-10-04-k19-10/20191003_104416.png "K19-10 VirtualBox - Open terminal")

### 5.5. Install additions

Install these packages on the host OS

```bash
# Install prerequisites
sudo apt install build-essential gcc make perl dkms;

# Install additions
sudo sh ./VBoxLinuxAdditions.run
```

Once installation is complete, reboot the computer. One may then adjust
copy-n-paste and drag-n-drop under the VirtualBox **Devices** menu. The
display may now also be resized.

![K19-10 VirtualBox - Install
addons](/images/2019-10-04-k19-10/20191003_110128.png "K19-10 VirtualBox - Install addons")

## 6. Configure Plasma [(top)](#toc) {#section6}

### 6.1. Configure panel

We prefer the panel on the right side to maximize vertical space. Right
click on the panel and select **Panel Options \> Configure Pannel**

![K19-10 Configure
panel](/images/2019-10-04-k19-10/20191003_110437.png "K19-10 Configure panel")

### 6.2. Move panel to right edge

Click on the screen edge button to move the panel.

![K19-10 Move panel to right
edge](/images/2019-10-04-k19-10/20191003_110506.png "K19-10 Move panel to right edge")

### 6.3. Widen the panel

We widen the panel a bit.

![K19-10 Widen the
panel](/images/2019-10-04-k19-10/20191003_110525.png "K19-10 Widen the panel")

### 6.4. Configure desktop

Right-click on the desktop and select **Configure Desktop**

![K19-10 Configure
desktop](/images/2019-10-04-k19-10/20191003_110545.png "K19-10 Configure desktop")

### 6.5. Change background

We like the picture of the day. Adjust as desired

![K19-10 Change
background](/images/2019-10-04-k19-10/20191003_110617.png "K19-10 Change background")

### 6.6. Hide toolbox

The toolbox can get in the way. After hiding, click **OK**.

![K19-10 Hide
toolbox](/images/2019-10-04-k19-10/20191003_110648.png "K19-10 Hide toolbox")

### 6.7. Open system settings

Open system settings from the K menu and then pin to the task manager.

![K19-10 Open system
settings](/images/2019-10-04-k19-10/20191003_110757.png "K19-10 Open system settings")

### 6.8. Change theme

Select Breeze Dark theme.

![K19-10 Change
theme](/images/2019-10-04-k19-10/20191003_111533.png "K19-10 Change theme")

### 6.9. Change cursor size

We prefer larger cursors for demonstration purposes. Change this in the
**Size** field.

![K19-10 Change cursor
size](/images/2019-10-04-k19-10/20191003_111605.png "K19-10 Change cursor size")

### 6.10. Disable splash screen

The splash screen only shows for a second or so on modern hardware.
Disabling removes visual noise.

![K19-10 Disable splash
screen](/images/2019-10-04-k19-10/20191003_111817.png "K19-10 Disable splash screen")

### 6.11 Set Colors

This should already be set to **Breeze Dark**.

![K19-10 Set Colors](/images/2019-10-04-k19-10/20191003_111957.png "K19-10 Set Colors")

### 6.12 Set Fonts

Those with 4K monitors may wish to scale their interface. The best
method we have found is to adjust the DPI value under fonts and leave
the \"fractional scaling\" setting alone. In this case, we leave the DPI
alone.

![K19-10 Set Fonts](/images/2019-10-04-k19-10/20191003_112042.png "K19-10 Set Fonts")

### 6.13 Set Icons

This should already be set to **Breeze Dark**.

![K19-10 Set Icons](/images/2019-10-04-k19-10/20191003_112243.png "K19-10 Set Icons")

### 6.14 Set Window Decorations

Click on **Application Style \> Window Decorations**. This should
already be set to **Breeze**. We do not change the title bar buttons.

![K19-10 Set Window
Decorations](/images/2019-10-04-k19-10/20191003_112658.png "K19-10 Set Window Decorations")

### 6.15 Set GTK style

Click on **Application Style \> GNOME/GTK Application Style**. Set to
**Breeze Dark** as shown. This is required to ensure GTK apps such as
Firefox or LibreOffice use a dark theme.

![K19-10 Set GTK
style](/images/2019-10-04-k19-10/20191013_213633.png "K19-10 Set GTK style")

### 6.16 Use Workspace defaults

Click on **Desktop Behavior**. Preserve defaults for Workspace.

![K19-10 Use Workspace
defaults](/images/2019-10-04-k19-10/20191003_112734.png "K19-10 Use Workspace defaults")

### 6.17 Adjust window edges

In **Desktop Behavior \> Screen Edges** turn off maximize features.
Instead, prefer to use **meta + leftarrow** or **meta + rightarrow** to
tile windows. One can also click with the middle or right mouse button
on the maximize-window control to toggle a window vertically or
horizontally.

![K19-10 Adjust window
edges](/images/2019-10-04-k19-10/20191003_113000.png "K19-10 Adjust window edges")

### 6.18. Set screen lock

In **Desktop Behavior \> Screen Locking** set the background to match
the desktop.

![K19-10 Set screen
lock](/images/2019-10-04-k19-10/20191003_185645.png "K19-10 Set screen lock")

### 6.19 Add virtual desktops

In **Desktop Behavior \> Virtual Desktops** add three rows and use slide
animation.

![K19-10 Add virtual
desktops](/images/2019-10-04-k19-10/20191003_185746.png "K19-10 Add virtual desktops")

### 6.22 Test sound

In **Multimedia \> Autia and Video** click on the **Test** button to
ensure audio is working.

![K19-10 Test sound](/images/2019-10-04-k19-10/20191003_201853.png "K19-10 Test sound")

### 6.23 Enable virtual desktops

Right click on the virtual desktop and select **Configure virtual
desktops** to ensure all three desktops are shown one per row.

![K19-10 Enable virtual
desktops](/images/2019-10-04-k19-10/20191003_202024.png "K19-10 Enable virtual desktops")

### 6.24. Move virtual desktops

Right click on the panel and select **Configure Panel** and then drag
the virtual desktop widget to the desired location on the panel.

![K19-10 Move virtual
desktops](/images/2019-10-04-k19-10/20191003_202100.png "K19-10 Move virtual desktops")

### 6.25. Admire the desktop

Virtual desktops are now at the bottom.

![K19-10 Admire the
desktop](/images/2019-10-04-k19-10/20191003_202125.png "K19-10 Admire the desktop")

## 7. Set-up Repositories and Install Apps [(top)](#toc) {#section7}

### 7.1. Open Konsole

The KDE terminal is called Konsole and it is very good. Pressed **alt +
space** and type **konsole** to quickly find the app and pressed return
to launch it.

![K19-10 Open
Konsole](/images/2019-10-04-k19-10/20191003_202335.png "K19-10 Open Konsole")

### 7.2. Pin Konsole to Panel

We use the terminal frequently.

![K19-10 Pin Konsole to
Panel](/images/2019-10-04-k19-10/20191003_202405.png "K19-10 Pin Konsole to Panel")

### 7.3 Ensure repositories are up-to-date

Use `sudo apt update && sudo apt upgrade && sudo apt     dist-upgrade`
to ensure all packages are up to date.

![K19-10 Ensure repositories are
up-to-date](/images/2019-10-04-k19-10/20191003_202716.png "K19-10 Ensure repositories are up-to-date")

### 7.4. Add repositories

Run the code below in the terminal to generate the file `vi ~/ag.txt`.
Each repository file destined for /etc/apt/sources.list.d us marked by
the `#_` prefix. subsequent lines are placed in the file. Empty lines
and those prefixed by `#x` are ignored.

![K19-10 Add
repositories](/images/2019-10-04-k19-10/20191003_202809.png "K19-10 Add repositories")

```bash
echo '#x Last update 2019-10-02
#x REMOVED
#x - repo.steampowered.com/steam replaced by using multiverse `steam-installer`
#x - ppa.launchpad.net/webupd8team/java/ubuntu was empty and apparently defunct
#x
#x [arch=amd64] is used to avoid warnings on some repos.
#x
#x Oracle Java license has changed. If needed, see linixhint.com/install_jdk12_ubuntu_1904
#x and `sudo add-apt-repository ppa:linuxuprising/java`
#x

#_ chrome-remote-desktop.list
deb [arch=amd64] http://dl.google.com/linux/chrome-remote-desktop/deb/ stable main

#_ docker.list
# 2019-10-02 Eoan, Disco not available
deb [arch=amd64] https://download.docker.com/linux/ubuntu cosmic stable

#_ dropbox.list
# 2019-10-02 Eoan, Disco not available
deb [arch=amd64] http://linux.dropbox.com/ubuntu cosmic main

#_ gimp.list
deb http://ppa.launchpad.net/otto-kesselgulasch/gimp/ubuntu eoan main

#_ google-chrome.list
deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main

#_ google-talk.list
# 2019-10-02 Disabled until I know I need it
# deb [arch=amd64] http://dl.google.com/linux/talkplugin/deb/ stable main

#_ graphics-drivers-ppa.list
deb http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu eoan main

#_ inkscape_dev-stable.list
# 2019-10-02 Disabled until eoan available (use default inkscape)
# deb http://ppa.launchpad.net/inkscape.dev/stable/ubuntu disco main

#_ insync.list
# 2019-10-02 Eoan not yet available
deb http://apt.insynchq.com/ubuntu disco non-free contrib

#_ kubuntu-ppa-backports.list
deb http://ppa.launchpad.net/kubuntu-ppa/backports/ubuntu eoan main

#_ neovim-stable-ppa.list
# 2019-10-02 Enable if desired, Eoan not yet available
# deb-src http://ppa.launchpad.net/neovim-ppa/stable/ubuntu disco main

#_ nodesource.list
# 2019-10-02 Eoan not yet available
deb https://deb.nodesource.com/node_10.x disco main

#_ skype-stable.list
deb [arch=amd64] https://repo.skype.com/deb stable main

#_ slack.list
deb https://packagecloud.io/slacktechnologies/slack/debian/ jessie main

#_ steam.list
# 2019-10-02 Disabled in favor of multiverse steam-installer

#_ stebbins-handbrake.list
# 2019-10-02 Eoan, Disco not available
deb http://ppa.launchpad.net/stebbins/handbrake-releases/ubuntu cosmic main

#_ teejee2008-ubuntu-ppa.list
# Provides TimeShift (see var/lib/apt/lists/, wajig detail timeshift)
# which looks useful
deb http://ppa.launchpad.net/teejee2008/ppa/ubuntu eoan main
' > ~/ag.txt
```

### 7.5. Install the repositories

We run a little script to convert `~/ag.txt` to repository definitions.

```bash
if ( sudo mv /etc/apt/sources.list.d /etc/apt/sources.list.d.O ); then
  sudo mkdir /etc/apt/sources.list.d;
  pushd /etc/apt/sources.list.d

  grep -Ev '^#x|^\s*$' ~/ag.txt | \
  while read line; do
    if ( echo "${line}" | grep -q '^#_' );
      then _tgt=$(echo "${line}"|cut -f2 -d' ');
    else echo "${line}" | sudo tee "${_tgt}" >> /dev/null
    fi;
  done
  popd
fi
```

![K19-10 Install
repositories](/images/2019-10-04-k19-10/20191003_203103.png "K19-10 Install repositories")

### 7.6. Update repository keys

This will find and install all the keys for the added repositories.
Please check these against verified sources.

```bash
sudo apt update 2>&1 |\
grep NO_PUBKEY |\
sed -e 's?^.*NO_PUBKEY ??' |\
while read _hash; do \
wget -O- "http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x${_hash}" |\
sudo apt-key add -;
done

sudo apt update && sudo apt upgrade
```

![K19-10 Update repository
keys](/images/2019-10-04-k19-10/20191003_203238.png "K19-10 Update repository keys")
![K19-10 Update
in-progress](/images/2019-10-04-k19-10/20191003_203354.png "K19-10 Update in-progress")

### 7.7. Generate ssh keys

This is required for gitolite3 installation.

```bash
mkdir .ssh
chmod 700 .ssh
ssh-keygen -t rsa
```

![K19-10 Generate ssh
keys](/images/2019-10-04-k19-10/20191008_202826.png "K19-10 Generate ssh keys")

### 7.8. Install repo packages

#### 7.8.1 Update packages

```bash
sudo apt update && sudo apt upgrade && sudo apt dist-upgrade
```
![K19-10 Install repo
packages](/images/2019-10-04-k19-10/20191003_203535.png "K19-10 Install repo packages")

#### 7.8.2. Install apps from repos

Do not copy the screenshot. Copy the code-block below as it is more
up-to-date.

```bash
sudo apt install apt-file audacity build-essential diffpdf dmidecode ffmpeg \
  gimp gimp-data-extras gimp-help-en git google-chrome-stable guvcview      \
  handbrake haskell-platform htop hwinfo kdiff3 kubuntu-restricted-extras   \
  meld mesa-utils mlocate mtp-tools mysql-client mysql-server net-tools     \
  nfs-common openssh-server p7zip-full p7zip-rar pandoc pandoc-citeproc     \
  pavucontrol pdfshuffler ppa-purge rar sdparm sysstat texlive tree         \
  ttf-mscorefonts-installer ubuntu-wallpapers vim-gtk vim-nox               \
  vim-syntax-gtk wajig xsel inkscape xserver-xorg-input-evdev;
```

![K19-10 Install apps from
repos](/images/2019-10-04-k19-10/20191003_204427.png "K19-10 Install apps from repos")

#### 7.8.3. Confirm install

![K19-10 Confirm
install](/images/2019-10-04-k19-10/20191003_204446.png "K19-10 Confirm install")

#### 7.8.4. Download apps

Installation will take 5-10 minutes.

![K19-10 Download
apps](/images/2019-10-04-k19-10/20191003_204505.png "K19-10 Download apps")

#### 7.8.5. Approve font install

After downloads some packages require the admin to assist in
configuration. The MS Font install requires approvals as shown.

![K19-10 Approve font
install](/images/2019-10-04-k19-10/20191003_204730.png "K19-10 Approve font install")
![K19-10 Approve font
install](/images/2019-10-04-k19-10/20191003_204809.png "K19-10 Approve font install")

#### 7.8.6 Configure Gitolite3

After downloads some packages require the admin to assist in
configuration. GitoLite3 requests three details.

This is the default. Do not change.

![K19-10 Gitolite Config
1](/images/2019-10-04-k19-10/20191008_202348.png "K19-10 Gitolite Config 1")

This is also the default. Do not change.

![K19-10 Gitolite Config
2](/images/2019-10-04-k19-10/20191008_202410.png "K19-10 Gitolite Config 2")

Specify the `id_rsa.pub` file generated earlier.

![K19-10 Gitolite Config
3](/images/2019-10-04-k19-10/20191008_202847.png "K19-10 Gitolite Config 3")

#### 7.8.6 Watch installation progress

Packages installation progress is as shown.

![K19-10 Watch installation
progress](/images/2019-10-04-k19-10/20191003_204834.png "K19-10 Watch installation progress")

### 7.9. Reboot after installation

Reboot the system once all packages are installed. Click on **K-menu** >
**Leave** > **Restart**.

## 8. Install addon apps [(top)](#toc) {#section8}

### 8.1. Dropbox

```bash
# Dropbox repo is added to sources above
sudo apt install -y dropbox
dropbox start -i
```

### 8.2. Docker

```bash
# Docker repo is added to sources above
sudo apt -y install docker-ce
```

### 8.3 Balsamiq
#### 8.3.1. Install wine packages

```bash
# http://deshack.net/install-balsamiq-mockups-in-debianubuntu/
sudo apt install -y wine-stable winetricks
```

![K19-10 Balsamiq - Install wine
packages](/images/2019-10-04-k19-10/20191004_155410.png "K19-10 Balsamiq - Install wine packages")

#### 8.3.2. Accept wine packages

Wine requires many i386 packages.

![K19-10 Balsamiq - Accept wine
packages](/images/2019-10-04-k19-10/20191004_155442.png "K19-10 Balsamiq - Accept wine packages")

#### 8.3.3. Download Balsamiq bundle

Bundled with Adobe Air from https://balsamiq.com/wireframes/desktop/

![K19-10 Balsamiq - Download
bundle](/images/2019-10-04-k19-10/20191004_160855.png "K19-10 Balsamiq - Download bundle")

#### 8.3.4. Install to /opt

```bash
pushd /opt
sudo unzip ~/Downloads/Balsamiq_Mockups_3.5.17_bundled.zip
sudo ln -s Balsamiq_Mockups_3 balsamiq_3_5_17
sudo ln -s Balsamiq_Mockups_3 balsamiq
pushd /opt/balsamiq
sudo ln -s 'Balsamiq Mockups 3.exe' balsamiq.exe
popd && popd
```

#### 8.3.5. Add a desktop file

This allows the user to easily access the app from the K-menu.

```bash
echo '[Desktop Entry]
Encoding=UTF-8
Name=Balsamiq Mockups
Icon=/opt/balsamiq/icons/mockups_ico_48.png
Exec=wine '/opt/balsamiq/Balsamiq Mockups 3.exe'
Type=Application
Categories=Graphics;
MimeType=application/x-xdg-protocol-tg;x-scheme-handler/tg;g;' \
  | sudo tee /usr/share/applications/balsamiq.desktop
  </div>
```

![K19-10 Balsamic - Add desktop
file](/images/2019-10-04-k19-10/20191004_161255.png "K19-10 Balsamic - Add desktop file")

#### 8.3.6. Start Balsamiq

Start Balsamiq with the K-menu (shown) or by typing **alt + space**
followed by **bals + enter** or enter `balsamiq` in the terminal.

![K19-10 Balsamic - Start
1](/images/2019-10-04-k19-10/20191004_161318.png "K19-10 Balsamic - Start  1") ![K19-10
Balsamic - Start
2](/images/2019-10-04-k19-10/20191004_161038.png "K19-10 Balsamic - Start 2")

### 8.4. IntelliJ

#### 8.4.1. Download IntelliJ Ultimate

Find the download here.
[here](https://www.jetbrains.com/idea/download/download#section=linux).

![K19-10 IntelliJ -
Download](/images/2019-10-04-k19-10/20191004_161753.png "K19-10 IntelliJ - Download")

Save as file.

![K19-10 IntelliJ - Save as
file](/images/2019-10-04-k19-10/20191004_161812.png "K19-10 IntelliJ - Save as file")

#### 8.4.2. Install to /usr/local/lib

```bash
sudo tar xvzf ~/Downloads/ideaIU-2019.2.3.tar.gz -C /usr/local/lib
```

![K19-10 IntelliJ - Install to
/usr/local/lib](/images/2019-10-04-k19-10/20191004_162012.png "K19-10 IntelliJ - Install to /usr/local/lib")
![K19-10 IntelliJ - Install
output](/images/2019-10-04-k19-10/20191004_162034.png "K19-10 IntelliJ - Install output")

#### 8.4.3. Create symbolic links

Symbolic links ensures the paths used by the desktop do not change. We
update the link to new pointers when we upgrade IntelliJ.

```bash
cd /usr/local/lib; sudo ln -s idea-IU-192.5728.98 intellij
cd /usr/local/bin; sudo ln -s ../lib/intellij/bin/idea.sh intellij
sudo mkdir -p /usr/local/img; cd /usr/local/img;
sudo ln -s ../lib/intellij/bin/idea.svg ./intellij.svg
```

![K19-10 IntelliJ - Create symbolic
links](/images/2019-10-04-k19-10/20191004_162541.png "K19-10 IntelliJ - Create symbolic links")

#### 8.4.4. Add desktop file

This allows the user to easily access the app from the K-menu.

```bash
echo '[Desktop Entry]
Version=1.0
Type=Application
Name=intellij
Icon=/usr/local/img/intellij.svg
Exec="/usr/local/bin/intellij" %f
Comment=Develop with pleasure!
Categories=Development;IDE;
Terminal=false
StartupWMClass=jetbrains-intellij' \
  | sudo tee /usr/share/applications/jetbrains-intellij.desktop
  </div>
```

![K19-10 IntelliJ - Add desktop
file](/images/2019-10-04-k19-10/20191004_162904.png "K19-10 IntelliJ - Add desktop file")

#### 8.4.5. Start IntelliJ

Start IntelliJ with the K-menu (shown) or by typing **alt + space**
followed by **intellij + enter** or enter `intellij` in the terminal.

![K19-10 IntelliJ - Start
IntelliJ](/images/2019-10-04-k19-10/20191004_164122.png "K19-10 IntelliJ - Start IntelliJ")

### 8.5. Google Drive (Insync)

Insync is better than the native client and supports multiple concurrent
accounts. However, GDrive is about 20 times slower than DropBox across
all platforms. Use Dropbox for copious files instead of GDrive to save
time.

```bash
sudo apt install -y insync insync-dolphin
```

### 8.6. Jekyll for Github.io Blogs

```bash
sudo apt install jekyll && sudo gem install jekyll-sitemap
cd Githug/mmikowski.io # Add correct path here
jekyll serve

# Now visit localhost:4000 with your browser to develop
```

### 8.7 MongoDB

Sources have been included in the installation shown above. See
https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/.
Read the documentation on **ulimit** to improve performance

### 8.8. Slack

A reliable Electron app. Go crazy.

```bash
sudo apt install -y slack-desktop
```

![K19-10 Slack](/images/2019-10-04-k19-10/20191009_194722.png "K19-10 Slack")

### 8.9 shrinkpdf

Reduce PDF size substantially. Copy the contents of Appendix A into
`~/bin/shrinkpdf`.

```bash
mkdir -p ~/bin && touch ~/bin/shrinkpdf && chmod 755 ~/bin/shrinkpdf
kate ~/bin/shrinkpdf
```

### 8.10 Telegram

```bash
sudo apt install -y telegram-desktop
```

![K19-10 Telegram](/images/2019-10-04-k19-10/20191008_204741.png "K19-10 Telegram")

## 9. Configure and Optimise [(top)](#toc) {#section9}

### 9.1 MarbleMouse - Config

Useful for making the most out of a MarbleMouse Trackball.

```bash
# https://help.ubuntu.com/community/Logitech_Marblemouse_USB.
# https://forums.linuxmint.com/viewtopic.php?t=276808 for increasing acceleration.
# Ensure the evdev extension for Xorg is installed
sudo apt install -y xserver-xorg-input-evdev

# 2. Add the following to /usr/share/X11/xorg.conf.d/50-marblemouse.conf
echo 'Section "InputClass"
        Identifier  "Marble Mouse"
        MatchProduct "Logitech USB Trackball"
        MatchIsPointer "on"
        MatchDevicePath "/dev/input/event*"
        Driver "evdev"
        Option "ButtonMapping" "1 8 3 4 5 6 7 2 2"
        Option "EmulateWheel" "true"
        Option "EmulateWheelButton" "8"
        Option "ZAxisMapping" "4 5"
        Option "XAxisMapping" "6 7" # Disable for vertical-only scrolling
        Option "Emulate3Buttons" "false"
EndSection
' | sudo tee /usr/share/X11/xorg.conf.d/50-marblemouse.conf
```

![K19-10 MarbleMouse -
Config](/images/2019-10-04-k19-10/20191004_155343.png "K19-10 MarbleMouse - Config")

### 9.2 Link config files

We link our config files from Dropbox. This helps minimize variance from
one environment to another.

```bash
 Link to config files stored in Dropbox
cd;
for _i in bashrc gitconfig ideavimrc vimrc;
  do _tgt=".${_i}";
  if [ -e "${_tgt}" ] && ! [ -L "${_tgt}" ]; then mv "${_tgt}" "${_tgt}.O"; fi
  rm -f "${_tgt}"; ln -s "Dropbox/01_SharedConfig/${_i}" "${_tgt}";
done

# Merge *.O files to the linked files and merge over enhancements using
# meld or kdiff3. Delete the *.O files after testing updates.
```

### 9.3 IntelliJ - Set Darcula theme

Choose File \> Settings \> Editor \> Color Scheme \> Darcula

![K19-10 IntelliJ - Set Darcula
Theme](/images/2019-10-04-k19-10/20191004_164454.png "K19-10 IntelliJ - Set Darcula Theme")

### 9.4 NFS - Add Network Disks

The automounter will wait until the network is available before
attempting to mount any disk marked with a \'\_netdev\' flag in
/etc/fstab. This is needed for NFS and other network file systems.

```bash
# https://help.ubuntu.com/community/NFSv4Howto
# http://thenubbyadmin.com/2013/04/10/solving-nfs-mounts-at-boot-time/
# http://askubuntu.com/questions/221293/why-is-chkconfig-no-longer-available-in-ubuntu

# 1. Install the nfsv4 client
sudo apt-get install nfs-common

# 2. Add entries to /etc/fstab file like so:
# <nfs-server>:<export_dir> <mount_dir> nfs _netdev,auto 0 0
```

### 9.4. Maximize Chrome GPU

```bash
# Nvidia Official Drivers
# 1. Ensure VDPAU drivers are installed
sudo apt install -y vdpau-driver-all vdpauinfo

# 2. Enable all GFX acceleration in Chrome.  Check GPU status with chrome://gpu.
# Adjust flags to enable GPU capabilities in chrome://flags and enable the
# following (these names are exact as of Chome 77):
#   x GPU Rasterization
#   x Native client
#   x Out of ordered rasterization
#   x Override software rendering list
#   x Skia API for OOP-D compositing
#   x Zero-copy rasterizer

# 3. Update all Exec lines in /usr/share/applications/google-chrome.desktop.
#    There are three locations.
#
#   Replace: Exec=/usr/bin/google-chrome-stable %U
#   With   : Exec=/usr/bin/google-chrome-stable \
#      --enable-native-gpu-memory-buffers --enable-zero-copy %U

# 4. Delete any local copies of google-chrome.desktop that can override
#    this system file. Use sudo locate google-chrome.desktop to find them.

# Other GPUs (Intel, AMD, Nouveau)
# Its been years since I have tweaked other GPUs. Any details welcome
 ``

![K19-10 Maximize Chrome
GPU](/images/2019-10-04-k19-10/20191004_200050.png "K19-10 Maximize Chrome GPU")

```bash
# RESULTS: chrome://gpu list with flags updated using NVidia GPU.

# Canvas                           : Hardware accelerated
# Flash                            : Hardware accelerated
# Flash Stage3D                    : Hardware accelerated
# Flash Stage3D Baseline profile   : Hardware accelerated
# Compositing                      : Hardware accelerated
# Multiple Raster Threads          : Enabled
# Out-of-process Rasterization     : Hardware accelerated
# Hardware Protected Video Decode  : Hardware accelerated
# Rasterization                    : Hardware accelerated
# Skia Renderer                    : Enabled
# Video Decode                     : Hardware accelerated
# Viz Display Compositor           : Enabled
# Viz Hit-test Surface Layer       : Enabled
# WebGL                            : Hardware accelerated
# WebGL2                           : Hardware accelerated

# DISABLE desktop compositing (shift-alt-f12) to maximize OGL/Vulcan perf.
# Frame rates can increase by 10x in some cases.
```

![K19-10 Maximize Chrome
GPU](/images/2019-10-04-k19-10/20191004_192059.png "K19-10 Maximize Chrome GPU")
![K19-10 Maximize Chrome
GPU](/images/2019-10-04-k19-10/20191004_204356.png "K19-10 Maximize Chrome GPU")

## Appendix A [(top)](#toc) {#apdx-a}

```bash
#!/bin/sh
# http://www.alfredklomp.com/programming/shrinkpdf
# Licensed under the 3-clause BSD license:
#
# Copyright (c) 2014, Alfred Klomp
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
# 1. Redistributions of source code must retain the above copyright notice,
#    this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright notice,
#    this list of conditions and the following disclaimer in the documentation
#    and/or other materials provided with the distribution.
# 3. Neither the name of the copyright holder nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.

# Low dpi (72) = better compression. High (300) = better quality
_dpi=72;

shrink () {
  gs \
    -q -dNOPAUSE -dBATCH -dSAFER        \
    -sDEVICE=pdfwrite                   \
    -dCompatibilityLevel=1.3            \
    -dPDFSETTINGS=/screen               \
    -dEmbedAllFonts=true                \
    -dSubsetFonts=true                  \
    -dColorImageDownsampleType=/Bicubic \
    -dColorImageResolution="${_dpi}"    \
    -dGrayImageDownsampleType=/Bicubic  \
    -dGrayImageResolution="${_dpi}"     \
    -dMonoImageDownsampleType=/Bicubic  \
    -dMonoImageResolution="${_dpi}"     \
    -sOutputFile="${2}"                 \
    "${1}";
}

check_smaller () {
  # If $1 and $2 are regular files, we can compare file sizes to
  # see if we succeeded in shrinking. If not, we copy $1 over $2:
  if [ ! -f "${1}" -o ! -f "${2}" ]; then
    return 0;
  fi
  ISIZE="$(echo $(wc -c "${1}") | cut -f1 -d\ )";
  OSIZE="$(echo $(wc -c "${2}") | cut -f1 -d\ )";
  if [ "${ISIZE}" -lt "${OSIZE}" ]; then
    echo "Input smaller than output, doing straight copy" >&2
    cp "${1}" "${2}";
  fi
}

usage () {
  echo "Reduces PDF filesize by lossy recompressing with Ghostscript.";
  echo "Not guaranteed to succeed, but usually works.";
  echo "  Usage: ${1} infile [outfile]";
}

IFILE="${1}";

# Set input file name
if [ -z "${IFILE}" ]; then
  usage "${0}";
  exit 1;
fi

# Default output filename to - (stdout) unless given
if [ ! -z "${2}" ]; then
  OFILE="${2}";
else
  OFILE="-";
fi

shrink "${IFILE}" "${OFILE}" || exit $?;
check_smaller "${IFILE}" "${OFILE}";
```
